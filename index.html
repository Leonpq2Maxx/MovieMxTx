
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro MovieTx</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
    .container { width: 90%; max-width: 400px; background: #222; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #000; }
    input, select { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; }
    button { background: #e50914; color: white; padding: 10px; width: 100%; border: none; border-radius: 5px; font-weight: bold; }
    .link { margin-top: 10px; text-align: center; }
    .hidden { display: none; }
    .success { color: lime; font-size: 0.9em; text-align: center; }
  </style>
</head>
<body>

<div class="container" id="registro-box">
  <h2>Registro</h2>
  <div id="registro-msg" class="success hidden"></div>
  <input type="text" id="nombre" placeholder="Nombre completo" required>
  <input type="email" id="new-email" placeholder="Correo electrónico" required>
  <input type="password" id="new-password" placeholder="Contraseña" required>
  <select id="plan">
    <option value="Básico">Básico - $3</option>
    <option value="Estándar">Estándar - $5</option>
    <option value="Premium">Premium - $8</option>
  </select>
  <button onclick="enviarRegistro()">Registrarse</button>
  <div class="link">¿Ya tienes cuenta? <a href="#" onclick="mostrarLogin()">Inicia sesión</a></div>
</div>

<div class="container hidden" id="login-box">
  <h2>Login</h2>
  <div id="login-error" class="success hidden"></div>
  <input type="email" id="email" placeholder="Correo electrónico" required>
  <input type="password" id="password" placeholder="Contraseña" required>
  <button onclick="verificarUsuario()">Entrar</button>
  <div class="link">¿No tienes cuenta? <a href="#" onclick="mostrarRegistro()">Regístrate</a></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz6eeBdEE7EaEysNyefv9t2rA97B9PrX4Q8CpdoFwIkBB1QBDIEnfb78FlRP9UpMU8o/exec"; // Reemplazar con tu URL real

function mostrarRegistro() {
  document.getElementById('login-box').classList.add('hidden');
  document.getElementById('registro-box').classList.remove('hidden');
}
function mostrarLogin() {
  document.getElementById('registro-box').classList.add('hidden');
  document.getElementById('login-box').classList.remove('hidden');
}

function verificarUsuario() {
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('password').value.trim();
  const error = document.getElementById('login-error');

  fetch(`${API_URL}?correo=${encodeURIComponent(email)}&password=${encodeURIComponent(pass)}`)
    .then(res => res.text())
    .then(text => {
      if (text === "OK") {
        window.location.href = "dashboard.html";
      } else if (text === "PENDIENTE") {
        error.textContent = "Tu cuenta aún no ha sido aprobada.";
        error.classList.remove('hidden');
      } else {
        error.textContent = "Usuario o contraseña incorrectos.";
        error.classList.remove('hidden');
      }
    })
    .catch(() => {
      error.textContent = "Error al conectar con el servidor.";
      error.classList.remove('hidden');
    });
}

function enviarRegistro() {
  const nombre = document.getElementById('nombre').value;
  const correo = document.getElementById('new-email').value;
  const pass = document.getElementById('new-password').value;
  const plan = document.getElementById('plan')?.value || "-";

  const payload = {
    nombre: nombre,
    correo: correo,
    password: pass,
    plan: plan
  };

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(payload),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.text())
  .then(text => {
    if (text === "OK") {
      const msg = document.getElementById('registro-msg');
      msg.textContent = "✅ Registro enviado. Espera aprobación.";
      msg.classList.remove('hidden');
    } else {
      alert("Error en el servidor: " + text);
    }
  })
  .catch(() => {
    alert("Error al enviar registro.");
  });
}
</script>

</body>
</html>
