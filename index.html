<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MovieTx - Inicio</title>
<style>
  body{margin:0;background:#000;color:#fff;font-family:Arial,Helvetica,sans-serif}
  header{background:#111;padding:12px 20px;display:flex;align-items:center;justify-content:space-between}
  .brand{color:#e50914;font-weight:900;font-size:20px}
  .actions button{background:#e50914;border:none;padding:8px 12px;border-radius:6px;color:#fff;cursor:pointer}
  main{padding:40px;display:flex;flex-direction:column;align-items:center;min-height:calc(100vh - 80px)}
  .card{background:#111;padding:20px;border-radius:8px;max-width:760px;width:100%}
  .muted{color:#bbb}
</style>
</head>
<body>
  <header>
    <div class="brand">MovieTx</div>
    <div class="actions">
      <button id="btn-logout">Cerrar sesión</button>
    </div>
  </header>
  <main>
    <h2>Bienvenido a MovieTx</h2>
    <p class="muted">Contenido premium aquí. Comprueba el estado de tu suscripción.</p>

    <div class="card" style="margin-top:20px">
      <div id="status">Comprobando suscripción...</div>
      <div style="margin-top:16px">
        <button id="btn-subscribe" style="background:#e50914;color:#fff;padding:10px 14px;border-radius:6px;border:none">Suscribirme 30 días</button>
      </div>
    </div>
  </main>

<script>
async function api(path, opts={}){
  opts.credentials = 'include';
  const res = await fetch(path, opts);
  return res.json();
}

document.getElementById('btn-logout').addEventListener('click', async () => {
  await api('/api/logout', { method: 'POST' });
  window.location.href = '/login.html';
});

document.getElementById('btn-subscribe').addEventListener('click', async () => {
  const resp = await api('/api/create_preference', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ planDays: 30 }) });
  if (resp.init_point) {
    window.location.href = resp.init_point;
  } else {
    alert('No se pudo iniciar el pago.');
  }
});

(async function(){
  const userResp = await api('/api/user');
  if (!userResp.user) {
    window.location.href = '/login.html';
    return;
  }
  const status = await api('/api/subscription-status');
  const el = document.getElementById('status');
  if (status.active) {
    el.innerHTML = '<strong style="color:#7bd389">Suscripción activa</strong><br>Vence: ' + status.expiresAt;
  } else {
    el.innerHTML = '<strong style="color:#f39a9a">No suscripto</strong><br>Podes suscribirte por 30 días.';
  }
})();
</script>
</body>
</html>