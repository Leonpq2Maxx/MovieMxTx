<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>MovieTx - Reproductor</title>
  <link href="https://fonts.googleapis.com/css2?family=PT+Sans&amp;family=Roboto&amp;display=swap" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/gh/CDNSFree2/Plyr/plyr.css" rel="stylesheet"/>
  <link href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" rel="stylesheet"/>
  <style>
    :root {
      --plyr-color-main: #ff0000;
      --plyr-video-control-color:rgb(255, 255, 255);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      outline: none;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    body {
      background-color: #000;
      font-family: 'PT Sans', sans-serif;
      color: #fff;
    }
    .player {
      position: relative;
      padding-top: 56.25%; /* 16:9 aspect ratio */
      height: 0;
      overflow: hidden;
      max-width: 100%;
      margin: 0 auto;
    }
    .player video,
    .player iframe,
    .player .plyr {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .info {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      padding: 10px;
      border: 1px solid rgba(16, 235, 255, 0.461);
      border-radius: 10px;
      margin: 10px;
      font-size: 14px;
    }
    .info i {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .hd-tag {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .hd-tag svg {
      border-radius: 4px;
    }
    .titulo, .sinopsis {
      padding: 10px;
    }
    .recomendaciones {
      padding: 10px;
    }
    .series-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      text-align: center;
    }
    .serie {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: white;
    }

    .serie img {
      width: 120px;
      height: 180px;
      object-fit: cover;
      border-radius: 10px;
    }

    .serie p {
      margin-top: 5px;
    }

    html { font-size: 100%; }
    body { font-size: 1rem; }
    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }
    h3, h4 { font-size: 1.2rem; }

    @media screen and (max-width: 768px) {
      body { font-size: 1.05rem; }
      h1 { font-size: 1.5rem; }
      h2 { font-size: 1.3rem; }
      h3, h4 { font-size: 1.1rem; }
      .info, .sinopsis p, .serie p {
        font-size: 0.80rem !important; /*estaba en 1rem*/
      }
    }

    @media screen and (max-width: 480px) {
      body { font-size: 1.1rem; }
      h1 { font-size: 1.4rem; }
      h2 { font-size: 1.2rem; }
      h3, h4 { font-size: 0.80rem; } /*estaba en 1rem*/
    }

    body, p, h1, h2, h3, h4, h5, h6, span, a, .titulo, .sinopsis, .recomendaciones, .serie {
      font-style: italic;
    }

    .info, .info *, .info span, .info i {
      font-style: normal !important;
    }

    #resume-msg {
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      padding: 10px 20px;
      color: #0f0;
      border-radius: 8px;
      z-index: 9999;
      font-weight: bold;
      max-width: 90%;
      font-size: 1rem;
      text-align: center;
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
      opacity: 0;
      transition: opacity 0.8s ease;
    }

    #resume-msg.visible {
      display: block;
      opacity: 1;
    }

    @media (max-width: 480px) {
      #resume-msg {
        font-size: 0.9rem;
        padding: 8px 16px;
      }
    }

    #genero-texto.colapsado {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ACA ES LA ANIMACION DE FAVORITOS */
    @keyframes pop {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    
    #btn-favorito.animado {
      animation: pop 0.3s ease;
    }
/* --- Mejor experiencia deslizable en m√≥vil --- */
@media (max-width: 880px) {
  /* Lista de temporadas horizontal deslizable */
  .seasons-list {
    display: flex;
    overflow-x: auto;
    gap: 12px;
    padding: 8px;
    -webkit-overflow-scrolling: touch; /* suavidad en iOS */
    scroll-snap-type: x mandatory;
  }

  .seasons-list ul {
    flex-direction: row;
    gap: 12px;
    width: max-content;
  }

  .seasons-list li {
    flex: 0 0 auto;
    scroll-snap-align: start;
    min-width: 160px;
  }

  .seasons-list::-webkit-scrollbar {
    display: none; /* oculta scrollbar en m√≥viles */
  }
}

@media (max-width: 768px) {
  /* Episodios tambi√©n deslizable si hay muchos */
  .episodes-grid {
  display: flex !important;
  flex-direction: column !important;
  gap: 12px !important;
  padding: 8px !important;
  overflow-x: visible !important;
  overflow-y: auto !important;
}

  .episodes-grid::-webkit-scrollbar {
    display: none;
  }

  .episode-card {
  flex: none !important;
  width: 100% !important;
  align-items: center !important;
}
}
/* Estilo para episodio en reproducci√≥n */
.episode-card.viendo {
  border: 2px solid var(--accent);
  background: rgba(255, 45, 91, 0.08);
  box-shadow: 0 0 12px rgba(255,45,91,0.6);
  position: relative;
}

.episode-card.viendo::after {
  content: "‚ñ∂ Viendo ahora";
  position: absolute;
  top: 8px;
  right: 8px;
  background: var(--accent);
  color: #fff;
  font-size: 0.7rem;
  font-weight: 600;
  padding: 3px 6px;
  border-radius: 6px;
}
#btn-favorito {
  background: linear-gradient(135deg, #ff2d55, #ff5e7e);
  color: white;
  padding: 12px 22px;
  border: none;
  border-radius: 999px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.3s ease;
  box-shadow: 0 8px 20px rgba(255, 45, 91, 0.35);
}

#btn-favorito:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 28px rgba(255, 45, 91, 0.55);
}

#btn-favorito::after {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    120deg,
    transparent,
    rgba(255, 255, 255, 0.25),
    transparent
  );
  transform: rotate(25deg);
  animation: shine 3s infinite;
}

@keyframes shine {
  0% { transform: translateX(-100%) rotate(25deg); }
  50% { transform: translateX(100%) rotate(25deg); }
  100% { transform: translateX(100%) rotate(25deg); }
}
.info-pelicula {
  text-align: center;
  margin-top: 20px;
  color: #fff;
}

.sinopsis {
  font-size: 1rem;
  color: #bbb;
  max-width: 600px;
  margin: 10px auto 20px;
}

.acciones {
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap;
}

.play-btn {
  background: linear-gradient(135deg, #1db954, #1ed760);
  color: white;
  padding: 12px 22px;
  border: none;
  border-radius: 999px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.3s ease;
  box-shadow: 0 8px 20px rgba(29, 185, 84, 0.35);
}

.play-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 28px rgba(29, 185, 84, 0.55);
}

#btn-favorito {
  background: linear-gradient(135deg, #ff2d55, #ff5e7e);
  color: white;
  padding: 12px 22px;
  border: none;
  border-radius: 999px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.3s ease;
  box-shadow: 0 8px 20px rgba(255, 45, 91, 0.35);
}

#btn-favorito:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 28px rgba(255, 45, 91, 0.55);
}

#btn-favorito::after {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    120deg,
    transparent,
    rgba(255, 255, 255, 0.25),
    transparent
  );
  transform: rotate(25deg);
  animation: shine 3s infinite;
}

@keyframes shine {
  0% { transform: translateX(-100%) rotate(25deg); }
  50% { transform: translateX(100%) rotate(25deg); }
  100% { transform: translateX(100%) rotate(25deg); }
}
  .season-episode-tag {
  display: inline-block;
  margin-top: 8px;
  margin-bottom: 14px;
  padding: 6px 14px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
  border: 1px solid rgba(255,255,255,0.15);
  color: #9ad0ff;
  font-weight: 600;
  font-size: 0.9rem;
  letter-spacing: 0.3px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.35);
}


  </style>
</head>

<body ondragstart="return false;" ondrop="return false;">

  <!-- VIDEO PLAYER -->
  <div class="player">
    <video id="mainVideo" class="vid1 js-player" controls loading="lazy" poster="https://image.tmdb.org/t/p/w780/bxPELhUZNgbFUN31EZTBC99wOHD.jpg" preload="metadata">
      <!-- default src will be set by script if user resumes or starts -->
      <source src="https://dl.dropbox.com/scl/fi/c4y8vmzvwttrw9y51zvz8/Annabelle.2014.1080P-Dual-Lat.mp4?rlkey=igq4az6ke0jtnu22suc5uyt51&st=" type="video/mp4">
    </video>
  </div>

  <!-- indicador -->
  <div id="episodio-actual"></div>

  <!-- Resume toast (kept) -->
  <div id="resume-msg">‚úÖ Reanudando donde lo dejaste: En el barro</div>

  <div class="info">
    <i class="fal fa-calendar-alt"></i><span>2025</span>
    <i class="fal fa-thumbs-up"></i><span>80%</span>
    <div class="hd-tag">
      <svg width="22" height="22" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <rect width="24" height="24" rx="4" fill="white" />
        <text x="4" y="17" fill="black" font-size="12" font-family="Arial, sans-serif" font-style="italic" font-weight="bold">HD</text>
      </svg>
      <span>1080P</span>
    </div>
    <span>üá≤üáΩ</span>
  </div>

  <div class="info-pelicula">
    <h1>En el barro</h1>
    <span class="genero-badge">Acci√≥n ‚Ä¢ Drama</span>
    <br><br>
    <button id="open-seasons" class="seasons-open-btn">Ver Temporadas & Episodios</button>
    <p class="sinopsis">Aqu√≠ va la sinopsis de la pel√≠cula...</p>
    <div class="acciones">
      <button id="btn-favorito">‚≠ê Agregar a Favoritos</button>
    </div>
  </div>
  <br>

  <!-- SEASONS / EPISODES MODAL -->
  <div id="seasons-modal" class="seasons-modal" aria-hidden="true" role="dialog" aria-label="Temporadas y episodios">
    <div class="seasons-backdrop" data-close></div>
    <div class="seasons-panel" role="document">
      <header class="seasons-header">
        <div>
          <h2 id="series-title">En el barro</h2>
          <p id="series-sub" class="muted">Selecciona temporada y episodio</p>
        </div>
        <button class="close-btn" id="close-seasons" aria-label="Cerrar modal">&times;</button>
      </header>
      <div class="seasons-body">
        <aside class="seasons-list" aria-label="Lista de temporadas">
          <ul id="seasons-list-ul"></ul>
        </aside>
        <section class="episodes-area" aria-live="polite">
          <div class="episodes-toolbar">
            <div class="season-meta">
              <strong id="season-label">Temporada 1</strong>
              <span id="season-desc" class="muted">‚Äî 8 episodios</span>
            </div>
            <div class="episodes-search">
              <input id="ep-search" placeholder="Buscar episodio..." />
            </div>
          </div>
          <div id="episodes-grid" class="episodes-grid" role="list"></div>
          <div id="episodes-footer" class="episodes-footer muted">
            Haz click en un episodio para reproducir / abrir.
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- RESUME MODAL (aparece al abrir la p√°gina si hay progreso) -->
  <div id="resume-modal" class="resume-modal" role="dialog" aria-modal="true" aria-label="Reanudar reproducci√≥n">
    <div class="resume-backdrop"></div>
    <div class="resume-card" role="document">
      <h3>¬øReanudar la reproducci√≥n donde la dejaste?</h3>
      <p id="resume-detail">√öltima vez estabas en Temporada 1 - Episodio 1</p>
      <div>
        <button id="btn-resume" class="resume-btn resume">‚ñ∂ Reanudar desde donde lo dejaste</button>
        <button id="btn-restart" class="resume-btn restart">üîÑ Iniciar desde 0</button>
      </div>
    </div>
  </div>

  <style>
    /* small cosmetic: play button inside cards */
    .play-btn{ background: linear-gradient(90deg, rgba(229,9,20,1), rgba(255,80,90,1)); color:white; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
  </style>

  <br>


<style>
  .modal-fav {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 99999;
  }
  .modal-fav[aria-hidden="false"] {
    display: flex;
    animation: fadeIn 0.4s ease forwards;
  }
  .modal-fav-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(6px);
  }
  .modal-fav-box {
    position: relative;
    background: linear-gradient(145deg, #0d0d0d, #1a1a1a);
    border: 2px solid #ff2d5b;
    border-radius: 14px;
    padding: 25px 30px;
    text-align: center;
    color: #fff;
    box-shadow: 0 0 25px rgba(255,45,91,0.5);
    max-width: 90%;
    width: 380px;
    z-index: 10;
    animation: scaleUp 0.3s ease forwards;
  }
  .modal-fav-box h3 {
    margin-bottom: 20px;
    font-size: 1.1rem;
    color: #fff;
  }
  #modal-fav-aceptar {
    background: linear-gradient(135deg, #ff2d5b, #ff5e7e);
    color: #fff;
    border: none;
    border-radius: 999px;
    padding: 10px 25px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    animation: bounceIn 0.6s ease;
  }
  #modal-fav-aceptar:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 0 15px rgba(255,45,91,0.8);
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes scaleUp {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  @keyframes bounceIn {
    0% { transform: scale(0.6); opacity: 0; }
    60% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); }
  }
</style>

<script>
  // üîπ Funci√≥n general para mostrar el modal
  function mostrarModalFavoritos(mensaje) {
    const modal = document.getElementById('modal-favoritos');
    const texto = document.getElementById('modal-fav-texto');
    const btnAceptar = document.getElementById('modal-fav-aceptar');
    texto.textContent = mensaje;
    modal.setAttribute('aria-hidden', 'false');

    let cerrarTimeout = setTimeout(() => cerrarModal(), 15000);

    function cerrarModal() {
      modal.setAttribute('aria-hidden', 'true');
      clearTimeout(cerrarTimeout);
    }

    btnAceptar.onclick = cerrarModal;
    modal.querySelector('.modal-fav-backdrop').onclick = cerrarModal;
  }

  // üîπ Bot√≥n "Agregar a Favoritos"
  document.getElementById('btn-favorito').addEventListener('click', () => {
    const nuevaSerie = {
      titulo: "En el barro",
      imagen: "https://image.tmdb.org/t/p/w780/kKi1YdzQNM87Mcz7WxxclHbevwr.jpg",
      genero: "Acci√≥n ‚Ä¢ Drama",
      archivo: "../View Series/En el barro (2025).html",
      tipo: "serie",
      timestamp: Date.now()
    };

    const btn = document.getElementById('btn-favorito');
    btn.classList.add('animado');
    setTimeout(() => btn.classList.remove('animado'), 300);

    let favoritos = JSON.parse(localStorage.getItem('favoritos_detalles') || '[]');

    if (!favoritos.some(f => f.titulo === nuevaSerie.titulo)) {
      favoritos.push(nuevaSerie);
      localStorage.setItem('favoritos_detalles', JSON.stringify(favoritos));
      mostrarModalFavoritos("‚≠ê Serie agregada a favoritos");
      setTimeout(() => window.location.href = "../View Peliculas/favoritos.html", 1800);
    } else {
      mostrarModalFavoritos("üé¨ Esta serie ya est√° agregada en favoritos");
    }
  });
</script>


<script>
  function mostrarModalFavoritoExistente() {
    const modal = document.getElementById('modal-ya-favorito');
    const btnAceptar = document.getElementById('btn-fav-aceptar');
    modal.setAttribute('aria-hidden', 'false');

    let cerrarTimeout = setTimeout(() => cerrarModal(), 15000); // auto cierre 15s

    function cerrarModal() {
      modal.setAttribute('aria-hidden', 'true');
      clearTimeout(cerrarTimeout);
    }

    btnAceptar.onclick = cerrarModal;
    modal.querySelector('.modal-fav-backdrop').onclick = cerrarModal;
  }
</script>


<!-- ---------- INICIA: Modal de Temporadas y Episodios ---------- -->


<!-- Modal -->
<div id="seasons-modal" class="seasons-modal" aria-hidden="true" role="dialog" aria-label="Temporadas y episodios">
  <div class="seasons-backdrop" data-close></div>
  <div class="seasons-panel" role="document">
    <header class="seasons-header">
      <div>
        <h2 id="series-title">T√≠tulo de la Serie / Colecci√≥n</h2>
        <p id="series-sub" class="muted">Selecciona temporada y episodio</p>
      </div>
      <button class="close-btn" id="close-seasons" aria-label="Cerrar modal">&times;</button>
    </header>

    <div class="seasons-body">
      <aside class="seasons-list" aria-label="Lista de temporadas">
        <ul id="seasons-list-ul"></ul>
      </aside>

      <section class="episodes-area" aria-live="polite">
        <div class="episodes-toolbar">
          <div class="season-meta">
            <strong id="season-label">Temporada 1</strong>
            <span id="season-desc" class="muted">‚Äî 8 episodios</span>
          </div>
          <div class="episodes-search">
            <input id="ep-search" placeholder="Buscar episodio..." />
          </div>
        </div>

        <div id="episodes-grid" class="episodes-grid" role="list"></div>

        <div id="episodes-footer" class="episodes-footer muted">
          Haz click en un episodio para reproducir / abrir.
        </div>
      </section>
    </div>
  </div>
</div>
  <br>
<!-- ---------- ESTILOS (dark, moderno, responsive) ---------- -->
<style>
  :root{
    --bg:#040406;
    --panel:#0b0b0d;
    --muted: #9aa3ae;
    --accent: #ff2d5b;
    --glass: rgba(255,255,255,0.03);
    --card: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    --radius: 12px;
    --shadow: 0 8px 30px rgba(0,0,0,0.7);
    --glass-border: rgba(255,255,255,0.04);
  }
  /* Button to open */
  .seasons-open-btn{
    background: linear-gradient(90deg, rgba(255,45,91,0.12), rgba(255,45,91,0.06));
    color: white;
    border: 1px solid rgba(255,255,255,0.06);
    padding: 10px 14px;
    border-radius: 999px;
    cursor: pointer;
    box-shadow: 0 4px 14px rgba(0,0,0,0.4);
    font-weight: 600;
    backdrop-filter: blur(6px);
  }

  /* Modal layout */
  .seasons-modal{ position: fixed; inset: 0; display: none; z-index: 9999; font-family: 'PT Sans', Roboto, sans-serif; }
  .seasons-modal[aria-hidden="false"]{ display: block; }
  .seasons-backdrop{ position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.75)); backdrop-filter: blur(6px); }
  .seasons-panel{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    width: min(1100px, 96%);
    max-height: 88vh;
    background: linear-gradient(180deg, #071018, #070607);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--glass-border);
    overflow: hidden;
    display:flex;
    flex-direction: column;
  }

  .seasons-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding: 16px 18px;
    gap:10px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  }
  .seasons-header h2{ margin:0; font-size:1.05rem; color:#fff; letter-spacing:0.2px; }
  .seasons-header .muted{ color: var(--muted); font-size:0.85rem; margin-top:2px; }

  .close-btn{
    background: transparent; color: #fff; border: none; font-size: 26px; line-height:1; cursor:pointer; padding:6px 10px; border-radius:8px;
  }
  .close-btn:hover{ background: rgba(255,255,255,0.02); }

  .seasons-body{ display:flex; gap:16px; padding: 18px; overflow: hidden; flex:1; min-height:320px; }

  /* temporadas (izq) */
  .seasons-list{ width: 220px; background: var(--glass); border-radius: 10px; padding:10px; flex-shrink:0; border:1px solid rgba(255,255,255,0.02); overflow:auto; }
  .seasons-list ul{ list-style:none; padding:6px; margin:0; display:flex; flex-direction:column; gap:8px; }
  .seasons-list li{
    display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; cursor:pointer;
    transition: transform .18s ease, background .18s ease, box-shadow .18s;
  }
  .season-thumb{ width:56px; height:36px; background-size:cover; background-position:center; border-radius:6px; flex-shrink:0; box-shadow: 0 6px 18px rgba(0,0,0,0.5); }
  .season-info{ display:flex; flex-direction:column; min-width:0; }
  .season-info .s-title{ color:#fff; font-weight:600; font-size:0.95rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .season-info .s-sub{ color:var(--muted); font-size:0.8rem; margin-top:2px; }

  .seasons-list li:hover{ transform: translateY(-3px); background: rgba(255,255,255,0.02); box-shadow: 0 10px 30px rgba(2,8,20,0.6); }
  .seasons-list li.active{ background: linear-gradient(90deg, rgba(255,45,91,0.12), rgba(255,45,91,0.03)); box-shadow: 0 12px 40px rgba(255,45,91,0.06); border:1px solid rgba(255,45,91,0.12); }

  /* episodes area (derecha) */
  .episodes-area{ flex:1; display:flex; flex-direction:column; gap:12px; overflow:auto; }
  .episodes-toolbar{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .episodes-search input{
    padding:8px 12px; width:220px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff;
  }
  .episodes-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:12px; padding-top:6px; }
  .episode-card{
    display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px; background:var(--card); border:1px solid rgba(255,255,255,0.02);
    cursor:pointer; transition: transform .16s ease, box-shadow .16s;
  }
  .episode-card:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(2,8,20,0.6); }
  .ep-thumb{ width:120px; height:68px; border-radius:8px; background-size:cover; background-position:center; flex-shrink:0; }
  .ep-meta{ display:flex; flex-direction:column; min-width:0; }
  .ep-title{ color:#fff; font-weight:700; font-size:0.95rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .ep-desc{ color:var(--muted); font-size:0.85rem; margin-top:6px; }
  .ep-actions{ margin-left:auto; display:flex; align-items:center; gap:8px; color:var(--muted); font-size:0.9rem; }

  .play-btn{
    background: linear-gradient(90deg, rgba(255,45,91,1), rgba(255,120,140,1)); color:white; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700;
    box-shadow: 0 6px 20px rgba(255,45,91,0.12);
  }

  .episodes-footer{ padding:8px 12px; font-size:0.85rem; }

  /* responsive */
  @media (max-width: 880px){
    .seasons-body{ flex-direction: column; padding: 12px; gap:12px; }
    .seasons-list{ width:100%; display:flex; overflow-x:auto; padding:8px; }
    .seasons-list ul{ flex-direction:row; gap:10px; }
    .seasons-list li{ min-width:170px; flex:0 0 auto; }
  }
  @media (max-width:480px){
    .episode-card{ padding:8px; gap:8px; }
    .ep-thumb{ width:96px; height:56px; }
    .episodes-grid{ grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:10px; }
    .seasons-panel{ width: 96%; max-height: 92vh; }
  }
  /* --- Mejoras de adaptaci√≥n m√≥vil --- */
@media (max-width: 768px) {
  .seasons-panel {
    width: 100% !important;
    height: 100% !important;
    max-height: none !important;
    border-radius: 0;
    left: 0;
    top: 0;
    transform: none;
  }

  .seasons-header {
    padding: 12px;
  }
  .seasons-header h2 {
    font-size: 1rem;
  }

  .episodes-search input {
    width: 100%;
    padding: 10px;
    font-size: 0.9rem;
  }

  .episodes-grid {
    grid-template-columns: 1fr !important;
    gap: 14px;
  }

  .episode-card {
    flex-direction: row;
    padding: 12px;
  }

  .ep-thumb {
    width: 120px;
    height: 70px;
  }

  .ep-title {
    font-size: 1rem;
  }

  .ep-desc {
    font-size: 0.85rem;
  }
}

@media (max-width: 480px) {
  .episode-card {
    flex-direction: column;
    align-items: flex-start;
  }

  .ep-thumb {
    width: 100%;
    height: 180px;
  }

  .ep-meta {
    margin-top: 8px;
  }

  .play-btn {
    width: 100%;
    padding: 10px;
    font-size: 1rem;
  }
}

</style>

<!-- ---------- SCRIPT: datos + interacci√≥n ---------- -->
<!-- ---------- SCRIPT: datos + interacci√≥n (integrado con progreso + resume modal) ---------- -->
  <script>
  (function(){
    // Unique key for this series (used to keep resume/progress isolated)
    const SERIES_KEY = "En_el_barro_2025"; // unique per serie

    // Your seasons/episodes dataset (you already provided 1 season, 8 episodes; first two have hrefs)
    const seasonsData = [
      {
        id: 1,
        title: "Temporada 1",
        thumb: "https://image.tmdb.org/t/p/w780/v8xHeTkIBOl51yRp0zcAu2VYhdZ.jpg",
        desc: "Lanzada 2025 ‚Äî 8 episodios",
        episodes: [
          { id: "s1e1", title: "Episodio 1", time: "45m", thumb: "", href: "https://dl.dropbox.com/scl/fi/bawnnxf6ccjy765pzdsr1/En-el-barro-Cap-1.mp4?rlkey=xf38z7zwucx1747ox9ax1389z&st=" },
          { id: "s1e2", title: "Episodio 2", time: "45m", thumb: "", href: "https://dl.dropbox.com/scl/fi/x63tx11kljnw75sh82f6x/En-el-barro-Cap-2.mp4?rlkey=twb14o7mk2rwvp52yxet5z0qn&st=" },
          { id: "s1e3", title: "Episodio 3", time: "45m", thumb: "", href: "" },
          { id: "s1e4", title: "Episodio 4", time: "45m", thumb: "", href: "" },
          { id: "s1e5", title: "Episodio 5", time: "45m", thumb: "", href: "" },
          { id: "s1e6", title: "Episodio 6", time: "45m", thumb: "", href: "" },
          { id: "s1e7", title: "Episodio 7", time: "45m", thumb: "", href: "" },
          { id: "s1e8", title: "Episodio 8", time: "45m", thumb: "", href: "" },
        ]
      }
    ];

    // DOM elements
    const openBtn = document.getElementById('open-seasons');
    const modal = document.getElementById('seasons-modal');
    const closeBtn = document.getElementById('close-seasons');
    const backdrop = document.querySelector('.seasons-backdrop');
    const seasonsListUL = document.getElementById('seasons-list-ul');
    const episodesGrid = document.getElementById('episodes-grid');
    const seasonLabel = document.getElementById('season-label');
    const seasonDesc = document.getElementById('season-desc');
    const epSearch = document.getElementById('ep-search');
    const seriesTitle = document.getElementById('series-title');
    const seriesSub = document.getElementById('series-sub');
    const mainVideo = document.getElementById('mainVideo');
    const episodioActualEl = document.getElementById('episodio-actual');

    // resume modal elements
    const resumeModal = document.getElementById('resume-modal');
    const resumeDetail = document.getElementById('resume-detail');
    const btnResume = document.getElementById('btn-resume');
    const btnRestart = document.getElementById('btn-restart');

    let activeSeasonIndex = 0;
    let currentEpisodeIndex = null; // index inside seasonsData[activeSeasonIndex].episodes
    let isUserInteracting = false; // to avoid saving while automatic navigation maybe

    // LocalStorage helpers
    const resumeKey = `resume_${SERIES_KEY}`; // holds {seasonIndex, episodeId, time}
    function saveResume(data){ localStorage.setItem(resumeKey, JSON.stringify(data)); }
    function loadResume(){ return JSON.parse(localStorage.getItem(resumeKey) || 'null'); }
    function clearResume(){ localStorage.removeItem(resumeKey); }

    function progressKeyFor(epId){ return `progress_${SERIES_KEY}_${epId}`; } // holds percent (0-100)
    function saveProgress(epId, percent){ localStorage.setItem(progressKeyFor(epId), String(percent)); }
    function loadProgress(epId){ return parseFloat(localStorage.getItem(progressKeyFor(epId)) || '0'); }
    function clearProgress(epId){ localStorage.removeItem(progressKeyFor(epId)); }

    // √öltimo episodio visto - show in page
    const ultimoEpKey = `ultimoEpisodio_${SERIES_KEY}`;
    function saveUltimo( info ){ localStorage.setItem(ultimoEpKey, JSON.stringify(info)); }
    function loadUltimo(){ return JSON.parse(localStorage.getItem(ultimoEpKey) || 'null'); }

    // UI: open/close seasons modal
    function openModal(){ modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; renderSeasons(); selectSeason(0); closeBtn.focus(); }
    function closeModal(){ modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    backdrop.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e) => { if(e.key === 'Escape') closeModal(); });

    // Render seasons (only 1 here)
    function renderSeasons(){
      seasonsListUL.innerHTML = '';
      seasonsData.forEach((s, idx) => {
        const li = document.createElement('li');
        li.className = idx === activeSeasonIndex ? 'active' : '';
        li.tabIndex = 0;
        li.setAttribute('role','button');
        li.innerHTML = `
          <div class="season-thumb" style="background-image:url('${s.thumb}')"></div>
          <div class="season-info">
            <div class="s-title">${s.title}</div>
            <div class="s-sub">${s.desc}</div>
          </div>
        `;
        li.addEventListener('click', () => selectSeason(idx));
        li.addEventListener('keydown', (ev) => { if(ev.key === 'Enter') selectSeason(idx); });
        seasonsListUL.appendChild(li);
      });
    }

    function selectSeason(index){
      activeSeasonIndex = index;
      Array.from(seasonsListUL.children).forEach((li, i) => li.classList.toggle('active', i === index));
      const season = seasonsData[index];
      seasonLabel.textContent = season.title;
      seasonDesc.textContent = `‚Äî ${season.episodes.length} episodios`;
      seriesTitle.textContent = "En el barro";
      seriesSub.textContent = `${season.title} ‚Ä¢ ${season.desc}`;
      epSearch.value = '';
      renderEpisodes(season.episodes);
    }

    // Render episodes with progress bars
    function renderEpisodes(episodes){
      episodesGrid.innerHTML = '';
      if(!episodes || episodes.length === 0){
        episodesGrid.innerHTML = `<div class="muted">No hay episodios disponibles.</div>`;
        return;
      }

      const ultimo = loadUltimo();

      episodes.forEach((ep, idx) => {
        const card = document.createElement('article');
        card.className = 'episode-card';
        card.setAttribute('role','listitem');

        // build inner HTML
        card.innerHTML = `
          <div class="ep-meta">
            <div class="ep-title">${ep.title}</div>
            <div class="ep-desc">${ep.time || ''}</div>
            <div class="ep-progress" id="progress-${ep.id}">
              <span class="bar" style="width:0%"></span>
            </div>
            <div class="ep-progress-percent" id="percent-${ep.id}" style="display:none;">0%</div>
          </div>
          <div class="ep-actions">
            <button class="play-btn" data-href="${ep.href || ''}" data-id="${ep.id}" data-idx="${idx}" aria-label="Reproducir ${ep.title}">‚ñ∂ Reproducir</button>
          </div>
        `;

        // Mark if ultimo (to show in list)
        if (ultimo && ultimo.id === ep.id) {
          card.classList.add('viendo');
        }

        // attach click handler for play
        const playBtn = card.querySelector('.play-btn');
        playBtn.addEventListener('click', (ev) => {
          const href = ev.currentTarget.dataset.href;
          const id = ev.currentTarget.dataset.id;
          const idx = parseInt(ev.currentTarget.dataset.idx, 10);
          if(href && href !== ''){
            playEpisodeByIndex(idx, true); // user-initiated
            closeModal();
          } else {
            alert('No hay un link v√°lido para este episodio: ' + ep.title);
          }
        });

        episodesGrid.appendChild(card);

        // set initial progress from localStorage
        const pct = Math.round(loadProgress(ep.id) || 0);
        const bar = document.querySelector(`#progress-${ep.id} .bar`);
        const pctText = document.getElementById(`percent-${ep.id}`);
        if(bar){
          bar.style.width = pct + '%';
          if(pct > 0 && pct < 100){
            if(pctText){ pctText.style.display = 'block'; pctText.textContent = pct + '%'; }
          } else {
            if(pctText) pctText.style.display = 'none';
          }
        }
      });
    }

    // Play episode by index in current season
    function playEpisodeByIndex(idx, userInitiated = false, startTime = 0){
      const season = seasonsData[activeSeasonIndex];
      if(!season) return;
      const ep = season.episodes[idx];
      if(!ep || !ep.href) {
        alert('Episodio no disponible.');
        return;
      }

      currentEpisodeIndex = idx;

      // set src and play
      const sourceEl = mainVideo.querySelector('source');
      sourceEl.setAttribute('src', ep.href);
      mainVideo.load();

      // mark UI
      document.querySelectorAll('.episode-card').forEach(c => c.classList.remove('viendo'));
      // find the corresponding card and add class
      const cardNodes = Array.from(document.querySelectorAll('.episode-card'));
      if(cardNodes[idx]) cardNodes[idx].classList.add('viendo');

      // save ultimo episodio info
      saveUltimo({
        temporada: seasonsData[activeSeasonIndex].title,
        episodio: ep.title,
        id: ep.id,
        idx: idx
      });

      // update top indicator
      episodioActualEl.textContent = `Viendo: ${seasonsData[activeSeasonIndex].title} - ${ep.title}`;

      // start playing and position
      mainVideo.addEventListener('loadedmetadata', function onMeta(){
        mainVideo.removeEventListener('loadedmetadata', onMeta);
        if(startTime && startTime > 0) {
          // clamp to duration-1
          const t = Math.min(startTime, mainVideo.duration ? mainVideo.duration - 0.5 : startTime);
          mainVideo.currentTime = t;
        }
        mainVideo.play().catch(()=>{ /* autoplay might be blocked */ });
      });

      // If userInitiated and modal resume exists, ensure resume saved
      if(userInitiated){
        saveResume({seasonIndex: activeSeasonIndex, episodeId: ep.id, episodeIdx: idx, time: 0});
      }
    }

    // Find index of episode by id
    function findEpisodeIndexById(epId){
      const eps = seasonsData[activeSeasonIndex].episodes;
      for(let i=0;i<eps.length;i++){ if(eps[i].id === epId) return i; }
      return -1;
    }

    // Advance to next episode (called when ended)
    function playNextEpisode(){
      const eps = seasonsData[activeSeasonIndex].episodes;
      if(currentEpisodeIndex === null) return;
      const nextIdx = currentEpisodeIndex + 1;
      if(nextIdx < eps.length){
        const nextEp = eps[nextIdx];
        if(nextEp.href && nextEp.href !== ''){
          // start next ep at 0
          playEpisodeByIndex(nextIdx, false, 0);
        } else {
          // next episode has no link -> stop and clear indicator
          currentEpisodeIndex = null;
          episodioActualEl.textContent = '';
        }
      } else {
        // no more episodes
        currentEpisodeIndex = null;
        episodioActualEl.textContent = '';
      }
    }

    // Update progress UI and storage while playing
    function onTimeUpdate(){
      if(currentEpisodeIndex === null) return;
      const season = seasonsData[activeSeasonIndex];
      const ep = season.episodes[currentEpisodeIndex];
      if(!ep) return;
      if(!mainVideo.duration || isNaN(mainVideo.duration)) return;

      const pct = Math.round((mainVideo.currentTime / mainVideo.duration) * 100);
      // update per-episode bar
      const bar = document.querySelector(`#progress-${ep.id} .bar`);
      const pctText = document.getElementById(`percent-${ep.id}`);
      if(bar){
        bar.style.width = pct + '%';
        if(pct > 0 && pct < 100){
          if(pctText){ pctText.style.display = 'block'; pctText.textContent = pct + '%'; }
        } else {
          if(pctText) pctText.style.display = 'none';
        }
      }
      // save progress to storage (every timeupdate ‚Äî it's fine; browser storage is fast)
      saveProgress(ep.id, pct);

      // save resume data (individual resume)
      saveResume({
        seasonIndex: activeSeasonIndex,
        episodeId: ep.id,
        episodeIdx: currentEpisodeIndex,
        time: mainVideo.currentTime
      });
    }

    // When video ends
    function onEnded(){
      if(currentEpisodeIndex === null) return;
      const season = seasonsData[activeSeasonIndex];
      const ep = season.episodes[currentEpisodeIndex];

      // Remove per-episode progress (episode finished)
      if(ep && ep.id) clearProgress(ep.id);
      // Also remove percent display
      const pctText = document.getElementById(`percent-${ep.id}`);
      const bar = document.querySelector(`#progress-${ep.id} .bar`);
      if(bar){ bar.style.width = '0%'; }
      if(pctText){ pctText.style.display = 'none'; }

      // video back to 0
      mainVideo.currentTime = 0;

      // remove resume for that episode (we'll update resume to next episode if it exists)
      // We'll find the next episode and auto-play it.
      const nextIdx = currentEpisodeIndex + 1;
      if(nextIdx < season.episodes.length && season.episodes[nextIdx].href){
        // save resume pointing to next ep at time 0
        saveResume({seasonIndex: activeSeasonIndex, episodeId: season.episodes[nextIdx].id, episodeIdx: nextIdx, time: 0});
        // small delay to ensure UX
        setTimeout(() => playEpisodeByIndex(nextIdx, false, 0), 400);
      } else {
        // no next: clear resume
        clearResume();
        currentEpisodeIndex = null;
        episodioActualEl.textContent = '';
      }
    }

    // Hook video events
    mainVideo.addEventListener('timeupdate', onTimeUpdate);
    mainVideo.addEventListener('ended', onEnded);

    // Resume modal logic: show at page load if resume exists
    document.addEventListener('DOMContentLoaded', () => {
      renderSeasons();
      selectSeason(0);

      const resumeData = loadResume();
      if(resumeData && resumeData.episodeId){
        // show resume modal
        resumeModal.classList.add('show');
        // detail text
        const seasonLabelTxt = seasonsData[resumeData.seasonIndex] ? seasonsData[resumeData.seasonIndex].title : 'Temporada';
        const epIndex = typeof resumeData.episodeIdx === 'number' ? resumeData.episodeIdx : findEpisodeIndexById(resumeData.episodeId);
        const epTitle = seasonsData[resumeData.seasonIndex] && seasonsData[resumeData.seasonIndex].episodes[epIndex] ? seasonsData[resumeData.seasonIndex].episodes[epIndex].title : '';
        resumeDetail.textContent = `√öltima vez estabas en ${seasonLabelTxt} - ${epTitle}`;
      } else {
        // if no resume exists, don't force playing; keep poster/default
      }

      // Restore visible "ultimo episodio" indicator if any
      const ultimo = loadUltimo();
      if (ultimo) {
        episodioActualEl.textContent = `Viendo: ${ultimo.temporada} - ${ultimo.episodio}`;
        // do not auto-play ‚Äî user chooses from modal
      }

      // Attach resume buttons events
      btnResume.addEventListener('click', () => {
        const data = loadResume();
        if(!data) { resumeModal.classList.remove('show'); return; }
        // set season index and play the saved episode/time
        if(typeof data.seasonIndex === 'number') activeSeasonIndex = data.seasonIndex;
        const idx = (typeof data.episodeIdx === 'number') ? data.episodeIdx : findEpisodeIndexById(data.episodeId);
        // update UI
        selectSeason(activeSeasonIndex);
        // play and jump to saved time
        playEpisodeByIndex(idx, false, data.time || 0);
        resumeModal.classList.remove('show');
      });

      btnRestart.addEventListener('click', () => {
        // clear resume and progress, start from first available episode
        clearResume();
        // clear all per-episode progress for this series
        const eps = seasonsData[0].episodes;
        eps.forEach(ep => clearProgress(ep.id));
        // re-render episodes to hide bars
        renderEpisodes(seasonsData[0].episodes);

        // play first episode if available
        const firstIdx = seasonsData[0].episodes.findIndex(e => e.href && e.href.length > 0);
        if(firstIdx !== -1){
          playEpisodeByIndex(firstIdx, true, 0);
        }
        resumeModal.classList.remove('show');
      });

      // Clicking backdrop or ESC to close resume modal should just hide it (we don't auto-start)
      document.querySelector('.resume-backdrop').addEventListener('click', ()=> resumeModal.classList.remove('show'));
      document.addEventListener('keydown', (e) => { if(e.key === 'Escape') resumeModal.classList.remove('show'); });

      // Render initial progress states for episodes (already done in renderEpisodes)
    });

    // Simple search
    epSearch.addEventListener('input', (e) => {
      const q = e.target.value.trim().toLowerCase();
      const eps = seasonsData[activeSeasonIndex].episodes || [];
      const filtered = eps.filter(x => x.title.toLowerCase().includes(q));
      renderEpisodes(filtered);
    });

    // keyboard focus trap for seasons modal (simple)
    modal.addEventListener('keydown', (e) => {
      if(e.key !== 'Tab') return;
      const focusable = modal.querySelectorAll('button, [tabindex], input');
      if(!focusable.length) return;
      const first = focusable[0];
      const last = focusable[focusable.length -1];
      if(e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if(!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    });

    // Expose a small function for debugging (optional)
    window.__playEpisodeIndex = function(i){ playEpisodeByIndex(i, true, 0); };

    // End IIFE
  })();
  </script>

  <!-- keep existing plyr init (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/plyr/3.6.7/plyr.min.js"></script>
  <script>
    // Initialize Plyr on the mainVideo (optional). If Plyr interferes with timeupdate events, the code still works.
    try {
      const player = new Plyr('#mainVideo', {
        controls: ['play-large','play','progress','current-time','duration','mute','volume','captions','settings','fullscreen']
      });
    } catch(e){ /* ignore if plyr fails */ }
  </script>

  <!-- small helpers for favoritos / historial (kept from your original file, unchanged) -->
  <script>
    function mostrarMensaje(texto) {
      const mensaje = document.getElementById('mensaje-confirmacion') || null;
      if(!mensaje) {
        const div = document.createElement('div');
        div.id = 'mensaje-confirmacion';
        div.style = "display:block; position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.85); color:#fff; padding:12px 24px; border-radius:8px; z-index:99999;";
        div.textContent = texto;
        document.body.appendChild(div);
        setTimeout(()=> div.remove(), 3000);
        return;
      }
      mensaje.textContent = texto;
      mensaje.style.display = 'block';
      mensaje.style.opacity = '1';
      setTimeout(() => { mensaje.style.opacity = '0'; setTimeout(()=> mensaje.style.display='none',500); }, 3000);
    }

    document.getElementById('btn-favorito').addEventListener('click', () => {
      mostrarMensaje("‚≠ê Agregado a Favoritos");
    });
  </script>
<!-- ---------- FIN: Modal de Temporadas y Episodios ---------- -->

  <style>
    .titulo-flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .genero-badge {
      padding: 4px 10px;
      background-color: rgba(255, 255, 255, 0.1);
      color: rgba(255, 0, 81, 1);
      border: 1px solid rgba(255, 0, 81, 1);
      border-radius: 20px;
      font-size: 0.7rem;
      font-style: normal;
      max-width: 135px;          /* Limita el ancho m√°ximo */
      white-space: nowrap;       /* No saltar de l√≠nea */
      overflow: hidden;          /* Oculta el exceso */
      text-overflow: ellipsis;   /* Agrega los ... */
    }

    .titulo {
      font-size: 0.7rem;
      font-style: normal;
      max-width: 200px;          /* Limita el ancho m√°ximo */
      white-space: nowrap;       /* No saltar de l√≠nea */
      overflow: hidden;          /* Oculta el exceso */
      text-overflow: ellipsis;   /* Agrega los ... */
    }

  </style>

  <style>
    .titulo-flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .genero-badge {
      padding: 4px 10px;
      background-color: rgba(255, 255, 255, 0.1);
      color: rgba(255, 0, 81, 1);
      border: 1px solid rgba(255, 0, 81, 1);
      border-radius: 20px;
      font-size: 0.7rem;
      font-style: normal;
      max-width: 135px;          /* Limita el ancho m√°ximo */
      white-space: nowrap;       /* No saltar de l√≠nea */
      overflow: hidden;          /* Oculta el exceso */
      text-overflow: ellipsis;   /* Agrega los ... */
    }
    
  </style>

  <br>

  <div class="recomendaciones">
    <h4>Podr√≠a interesarte:</h4>
    <br/>
    <div class="series-grid">
      <a href="" class="serie">
        <img loading="lazy" src="" alt="">
        <p></p>
      </a>
      <a href="" class="serie">
        <img loading="lazy" src="" alt="">
        <p></p>
      </a>
      <a href="" class="serie">
        <img loading="lazy" src="" alt="">
        <p></p>
      </a>
      <a href="" class="serie">
        <img loading="lazy" src="" alt="">
        <p></p>
      </a>
      <a href="" class="serie">
        <img loading="lazy" src="" alt="">
        <p></p>
      </a>
      <a href="" class="serie">
        <img loading="lazy" src="" alt="">
        <p></p>
      </a>
    </div>
  </div>
  
  <!-- ¬°¬°¬°NO BORRAR ESTE SCRIPT ES DE FAVORITOS Y SI LO BORRAN AFECTARAN EL FUNCIONAMIENTO DE REPRODUCTOR Y FAVORITOS!!! -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/plyr/3.6.7/plyr.min.js">
    document.getElementById('btn-favorito').addEventListener('click', () => {

      let favoritos = JSON.parse(localStorage.getItem('favoritos_detalles') || '[]');
      if (!favoritos.some(f => f.titulo === nuevaPelicula.titulo)) {
        favoritos.push(nuevaPelicula);
        localStorage.setItem('favoritos_detalles', JSON.stringify(favoritos));
      }
      window.location.href = "../View Peliculas/favoritos.html";
    });
  </script>
  
  <script>
    const videoElement = document.querySelector('.vid1');
    const videoSrc = videoElement.querySelector('source').getAttribute('src');
    const STORAGE_KEY = 'pos_' + videoSrc;

    const player = new Plyr(videoElement, {
      controls: [
        'rewind', 'play-large', 'play', 'fast-forward',
        'progress', 'current-time', 'duration', 'mute', 'volume',
        'captions', 'settings', 'pip', 'airplay', 'fullscreen'
      ]
    });

    // ‚úÖ Reanudar episodio al presionar Play
player.on('play', () => {
  const ultimo = JSON.parse(localStorage.getItem(`ultimoEpisodio_${SERIES_KEY}`) || 'null');
  if (ultimo) {
    const season = seasonsData.find(s => s.title === ultimo.temporada);
    const ep = season ? season.episodes.find(e => e.id === ultimo.id) : null;

    if (ep && ep.href) {
      const currentSrc = videoElement.querySelector('source').getAttribute('src');
      if (currentSrc !== ep.href) {
        // Cambiar al episodio guardado
        const source = videoElement.querySelector('source');
        source.setAttribute('src', ep.href);
        videoElement.load();
        videoElement.play();

        // Mostrar indicador en pantalla
        document.getElementById('episodio-actual').textContent =
          `üîÅ Continuando: ${ultimo.temporada} - ${ultimo.episodio}`;
      }
    }
  }
});


    document.addEventListener('DOMContentLoaded', () => {
      const savedTime = localStorage.getItem(STORAGE_KEY);
      // ‚ùå Evita reanudar desde el tiempo guardado
  // if (savedTime && parseFloat(savedTime) > 10) {
  //   videoElement.currentTime = parseFloat(savedTime);
  //   const msg = document.getElementById('resume-msg');
  //   msg.classList.add('visible');
  //   setTimeout(() => msg.classList.remove('visible'), 5000);
  // }

      const controls = document.querySelector('.plyr__controls');
  if (controls && !document.getElementById('custom-rewind')) {
    const rewindBtn = document.createElement('button');
    rewindBtn.id = 'custom-rewind';
    rewindBtn.className = 'plyr__control';
    rewindBtn.setAttribute('aria-label', 'Retroceder 10 segundos');
    rewindBtn.innerHTML = '<i class="fas fa-undo"></i>';
    rewindBtn.onclick = () => {
      videoElement.currentTime = 0;
    };
    controls.insertBefore(rewindBtn, controls.firstChild);
  }
});
    
    setInterval(() => {
      if (!videoElement.paused && !videoElement.ended) {
        localStorage.setItem(STORAGE_KEY, videoElement.currentTime);
      }
    }, 5000);
    
    /* ACA VA LA NOMBRE, IMAGEN, GENERO, ARCHIVO DONDE GUARDAN SU HTML DE PELICULA Y EL TIEMPO */
    document.getElementById('btn-favorito').addEventListener('click', () => {
      const nuevaPelicula = {
        titulo: "En el barro",
        imagen: "https://image.tmdb.org/t/p/original/kKi1YdzQNM87Mcz7WxxclHbevwr.jpg",
        genero: "Genero",
        archivo: "../View Series/En el barro (2025).html",
        tipo: "serie",
        timestamp: Date.now()
      };

      /* animacion de favoritos */
      const btn = document.getElementById('btn-favorito');
      btn.classList.add('animado');
      setTimeout(() => btn.classList.remove('animado'), 300);

      let favoritos = JSON.parse(localStorage.getItem('favoritos_detalles') || '[]');
      if (!favoritos.some(f => f.titulo === nuevaPelicula.titulo)) {
  favoritos.push(nuevaPelicula);
  localStorage.setItem('favoritos_detalles', JSON.stringify(favoritos));
  window.location.href = "../View Peliculas/favoritos.html";
} else {
  mostrarModalFavoritoExistente();
}

    });
  </script>

  <script>
    function mostrarMensaje(texto) {
      const mensaje = document.getElementById('mensaje-confirmacion');
      mensaje.textContent = texto;
      mensaje.style.display = 'block';
      mensaje.style.opacity = '1';
      setTimeout(() => {
        mensaje.style.opacity = '0';
        setTimeout(() => mensaje.style.display = 'none', 500);
      }, 3000);
    }
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const videoElement = document.querySelector('.vid1');
      if (!videoElement) return;

      const videoSrc = videoElement.querySelector('source').getAttribute('src');
      const STORAGE_KEY = 'pos_' + videoSrc;

      /*ACA VA EL NOMBRE, IMAGEN, HTML DONDE ESTA UBICADO SU HTML (HISTORIAL)*/
      const historialTitulo = "En el barro";
      const historialImagen = "https://image.tmdb.org/t/p/w300/kKi1YdzQNM87Mcz7WxxclHbevwr.jpg";
      const historialArchivo = "../View Series/En el barro (2025).html";

      let historial = JSON.parse(localStorage.getItem('historial_usuarios') || '[]');
      let indexHist = historial.findIndex(item => item.titulo === historialTitulo);
      
      if (indexHist === -1) {
        historial.push({
        titulo: historialTitulo,
        imagen: historialImagen,
        progreso: "Asistido 0 min",
        archivo: historialArchivo,
        tipo: "serie", // ‚úÖ ya est√°
        timestamp: Date.now()
      });
      localStorage.setItem('historial_usuarios', JSON.stringify(historial));
      indexHist = historial.length - 1;
      mostrarModalFavoritos("‚úÖ Agregado al historial");

    }
    setInterval(() => {
      if (!videoElement.paused && !videoElement.ended) {
        historial = JSON.parse(localStorage.getItem('historial_usuarios') || '[]');
        indexHist = historial.findIndex(item => item.titulo === historialTitulo);
        if (indexHist !== -1) {
          const minutos = Math.floor(videoElement.currentTime / 60);
          historial[indexHist].progreso = `Asistido ${minutos} min`;
          historial[indexHist].timestamp = Date.now(); // ‚úÖ esto asegura que suba al principio
          localStorage.setItem('historial_usuarios', JSON.stringify(historial));
        }
        localStorage.setItem(STORAGE_KEY, videoElement.currentTime);
      }
    }, 10000);
    });
  </script>
</body>
</html>












