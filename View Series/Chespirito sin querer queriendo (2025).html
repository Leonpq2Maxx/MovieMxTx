<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MovieTx - Reproductor De Serie</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.6.12/plyr.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <link href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" rel="stylesheet">
  <style>
    body { background:#000; color:#fff; font-family:'PT Sans',sans-serif; margin:0; padding:0; }

    .main-video { width:100%; max-width:900px; margin:0 auto; }
    .main-video video { width:100%; border-radius:8px; }

    #episodios { display:flex; flex-wrap:nowrap; gap:10px; padding:10px; overflow-x:auto; }
    #episodios button {
      min-width:40px; height:40px; flex:0 0 auto;
      background:#222; border:none; border-radius:5px;
      color:#ccc; font-size:1rem; cursor:pointer;
    }
    #episodios button.active { background:red !important; color:#fff !important; }

    /* Mensaje flotante */
    #resume-msg {
      display:none;
      position:fixed;
      bottom:20px; left:50%;
      transform:translateX(-50%);
      background:rgba(0,0,0,0.9);
      padding:15px 20px;
      border-radius:10px;
      box-shadow:0 0 12px rgba(0,255,0,0.3);
      z-index:9999;
      opacity:0;
      transition:opacity 0.5s ease;
      text-align:center;
      max-width:90%;
    }
    #resume-msg.visible { display:block; opacity:1; }
    #resume-msg button {
      margin:10px 5px 0;
      padding:6px 12px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    #resume-btn { background:#0f0; color:#000; }
    #restart-btn { background:#f00; color:#fff; }
  </style>
</head>
<body>

  <h2 style="text-align:center;">Chespirito: Sin querer queriendo (2025)</h2>

  <div class="main-video">
    <video class="js-player" controls poster="https://image.tmdb.org/t/p/w780/y8tPZ9P4tYqYiACs6t4mlcWJnSC.jpg">
      <source src="https://www.udrop.com/file/6goa/1x1" type="video/mp4">
    </video>
  </div>

  <div style="display:flex; justify-content:space-between; padding:10px;">
    <select id="temporada-select" style="background:#1c1c1c; color:#fff; padding:5px 10px; border-radius:5px; border:1px solid #333;">
      <option value="1" selected>Temporada 1</option>
    </select>
    <div id="episodio-count" style="color:#bbb;">0 Capítulos</div>
  </div>

  <div id="episodios"></div>

  <!-- Mensaje flotante -->
  <div id="resume-msg">
    <p id="resume-text"></p>
    <button id="resume-btn">▶ Reanudar</button>
    <button id="restart-btn">↺ Desde inicio</button>
  </div>

  <script src="https://cdn.plyr.io/3.6.12/plyr.js"></script>
  <script>
    const episodiosData = {
      1: [
        { titulo:"Episodio 1 - Zapatero a tus zapatos", src:"https://dl.dropbox.com/scl/fi/2rxn8bbjx7offllrzzddk/Chespirito-sin-querer-queriendo-T1-C1.mp4" },
        { titulo:"Episodio 2 - No hay mal que por bien no venga", src:"https://dl.dropbox.com/scl/fi/6sr2f4vypmw7r9iv0xtax/Chespirito-sin-querer-queriendo-T1-C2.mp4" },
        { titulo:"Episodio 3 - Que no panda el cúnico", src:"https://dl.dropbox.com/scl/fi/8d92w87l1ignjd8mev0ff/Chespirito-sin-querer-queriendo-T1-C3.mp4" },
        { titulo:"Episodio 4 - Es que no me tienen paciencia", src:"https://dl.dropbox.com/scl/fi/kx7zbroyx4mso2je46syv/Chespirito-sin-querer-queriendo-T1-C4.mp4" },
        { titulo:"Episodio 5 - El que ríe al último", src:"https://dl.dropbox.com/scl/fi/gc9b1435w1c1d72erjzzq/Chespirito-sin-querer-queriendo-T1-C5.mp4" },
        { titulo:"Episodio 6", src:"https://dl.dropbox.com/scl/fi/v8xkbejc01pf2gn193z85/Chespirito-sin-querer-queriendo-T1-C6.mp4" }
      ]
    };

    const mainVideo = document.querySelector(".main-video video");
    const temporadaSelect = document.getElementById("temporada-select");
    const episodiosContainer = document.getElementById("episodios");
    const episodioCount = document.getElementById("episodio-count");
    const resumeMsg = document.getElementById("resume-msg");
    const resumeText = document.getElementById("resume-text");
    const resumeBtn = document.getElementById("resume-btn");
    const restartBtn = document.getElementById("restart-btn");

    let currentEpisodeIndex = 0;

    function renderEpisodios(temporada) {
      episodiosContainer.innerHTML = "";
      const episodios = episodiosData[temporada] || [];
      episodioCount.textContent = `${episodios.length} Capítulos`;

      episodios.forEach((ep, index) => {
        const btn = document.createElement("button");
        btn.textContent = index+1;
        btn.onclick = () => playEpisode(ep.src, ep.titulo, index);
        episodiosContainer.appendChild(btn);
      });
    }

    // Guardar progreso cada 5s
    setInterval(() => {
      if (!mainVideo.paused && !mainVideo.ended) {
        const temporada = temporadaSelect.value;
        localStorage.setItem(`resume_${temporada}_${currentEpisodeIndex}`, mainVideo.currentTime);
      }
    }, 5000);

    function playEpisode(src, titulo, index) {
      currentEpisodeIndex = index;
      const temporada = temporadaSelect.value;
      const key = `resume_${temporada}_${index}`;
      const savedTime = parseFloat(localStorage.getItem(key));

      localStorage.setItem("ultimo_episodio", JSON.stringify({ temporada, index }));

      mainVideo.src = src;
      mainVideo.load();

      if (!isNaN(savedTime) && savedTime > 10) {
        const min = Math.floor(savedTime/60);
        const sec = ("0"+Math.floor(savedTime%60)).slice(-2);
        resumeText.textContent = `Estabas viendo "${titulo}" en el minuto ${min}:${sec}`;
        resumeMsg.classList.add("visible");

        resumeBtn.onclick = () => {
          mainVideo.currentTime = savedTime;
          resumeMsg.classList.remove("visible");
          marcarVisto(index);
        };
        restartBtn.onclick = () => {
          mainVideo.currentTime = 0;
          resumeMsg.classList.remove("visible");
          marcarVisto(index);
        };
      } else {
        mainVideo.currentTime = 0;
        marcarVisto(index);
      }
    }

    function marcarVisto(index) {
      const buttons = document.querySelectorAll("#episodios button");
      buttons.forEach(btn => {
        btn.classList.remove("active");
        btn.style.background="#222";
        btn.style.color="#ccc";
      });
      buttons[index]?.classList.add("active");
      buttons[index].style.background="red";
      buttons[index].style.color="#fff";
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderEpisodios(temporadaSelect.value);

      const ultimo = JSON.parse(localStorage.getItem("ultimo_episodio") || "{}");
      if (ultimo.temporada && typeof ultimo.index==="number") {
        temporadaSelect.value = ultimo.temporada;
        renderEpisodios(ultimo.temporada);
        const ep = episodiosData[ultimo.temporada][ultimo.index];
        if (ep) playEpisode(ep.src, ep.titulo, ultimo.index);
      }
    });
  </script>
</body>
</html>
