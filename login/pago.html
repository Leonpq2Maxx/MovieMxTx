<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>Pago - MovieTx</title>

<style>
/* ------------------------- */
/* ESTILO BASE – FULL MOBILE */
/* ------------------------- */
body{
  margin:0;
  font-family:Arial;
  background:#000;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:14px;
  box-sizing:border-box;
}

/* Contenedor principal responsivo */
.wrap{
  width:100%;
  max-width:420px;
  padding:20px;
  background:linear-gradient(180deg,#0b0b0c,#111);
  border-radius:12px;
  box-sizing:border-box;
}

/* Títulos */
h2{
  margin:0 0 8px 0;
  font-size:22px;
  text-align:center;
}

/* Mensaje */
.note{
  background:#111;
  padding:10px;
  border-radius:6px;
  color:#f5c542;
  margin-bottom:12px;
  font-size:15px;
}

/* Inputs */
input,textarea{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:6px;
  border:0;
  background:#121214;
  color:#fff;
  font-size:15px;
  box-sizing:border-box;
}

/* Botones */
button{
  width:100%;
  padding:14px;
  margin-top:14px;
  border-radius:6px;
  border:0;
  background:#e50914;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  font-size:16px;
}

/* Texto pequeño */
.small{
  font-size:14px;
  color:#bbb;
  margin-top:10px;
  text-align:center;
}

/* Previews */
.ticket-preview,
.profile-wrap{
  background:#0f0f10;
  padding:12px;
  border-radius:6px;
  margin-top:12px;
  text-align:center;
}

img.preview{
  max-width:100%;
  border-radius:6px;
  margin-top:8px;
}

/* Foto de perfil redonda */
.profile-preview{
  width:110px;
  height:110px;
  border-radius:50%;
  object-fit:cover;
  margin-top:10px;
  border:3px solid #333;
}



/* ------------------------------------------- */
/* BREAKPOINTS: MÁS AJUSTES PARA PANTALLAS     */
/* ------------------------------------------- */

/* Pantallas MUY CHICAS (320px) */
@media (max-width:360px){
  h2{ font-size:19px; }
  input,button{ font-size:14px; }
  .profile-preview{ width:95px;height:95px; }
}

/* Pantallas MEDIANAS (450–600px) */
@media (min-width:450px){
  h2{ font-size:24px; }
  button{ font-size:17px; }
  .profile-preview{ width:120px;height:120px; }
}

/* Pantallas GRANDES tipo tablet */
@media (min-width:700px){
  .wrap{
    padding:30px;
    max-width:500px;
  }
  h2{ font-size:26px; }
}

</style>
</head>

<body>
<div class="wrap">
  <h2>Pago Mensual - $3000 ARS</h2>

  <div id="msg" class="note" style="display:none"></div>

  <p style="font-size:15px;text-align:center;">
    Tu pago lo podés hacer con Mercado Pago. Luego completa el formulario de comprobante para que lo verifiquemos.
  </p>

  <button onclick="openMP()">Ir a Mercado Pago</button>

  <h3 style="margin-top:16px;font-size:18px;text-align:center;">Enviar comprobante</h3>

  <label>Ingrese ID de pago (referencia):</label>
  <input id="payId" placeholder="Ej: 123456789" />

  <label>Últimos 4 dígitos del CBU desde donde enviaste:</label>
  <input id="last4" placeholder="Ej: 1823" maxlength="4"/>

  <label>Subir captura del pago:</label>
  <input id="file" type="file" accept="image/*" />
  <div class="ticket-preview" id="previewArea" style="display:none"></div>

  <!-- FOTO PERFIL -->
  <label>Subir foto de perfil:</label>
  <input id="profilePic" type="file" accept="image/*" />
  <div class="profile-wrap" id="profilePreviewArea" style="display:none"></div>

  <button onclick="sendProof()">Enviar comprobante</button>

  <div class="small"><a href="index.html" style="color:#fff">Volver</a></div>
</div>



<script>
const MP_LINK = "TU_LINK_MERCADO_PAGO_AQUI";

/* Mensaje de advertencia */
window.onload = () => {
  const params = new URLSearchParams(window.location.search);

  if(params.get('needpay') === '1'){
    const msg = document.getElementById('msg');
    msg.style.display = 'block';
    msg.innerText =
      'Debes realizar el pago para continuar usando MovieTx. Envía comprobante y espera verificación.';
  }
};

/* Abrir Mercado Pago */
function openMP(){
  window.open(MP_LINK, '_blank');
}

/* PREVIEW DEL COMPROBANTE */
document.getElementById('file').addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;

  const reader = new FileReader();
  reader.onload = ev=>{
    const data = ev.target.result;
    const p = document.getElementById('previewArea');
    p.style.display='block';
    p.innerHTML = `
      <strong>Preview del comprobante:</strong><br>
      <img class="preview" src="${data}">
    `;
    p.dataset.img = data;
  };
  reader.readAsDataURL(f);
});

/* PREVIEW FOTO PERFIL */
document.getElementById('profilePic').addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;

  const reader = new FileReader();
  reader.onload = ev=>{
    const data = ev.target.result;
    const p = document.getElementById('profilePreviewArea');
    p.style.display='block';
    p.innerHTML = `
      <strong>Foto de perfil:</strong><br>
      <img class="profile-preview" src="${data}">
    `;
    p.dataset.pic = data;
  };
  reader.readAsDataURL(f);
});

/* ENVIAR AL ADMIN */
function sendProof(){
  const payId = document.getElementById('payId').value.trim();
  const last4 = document.getElementById('last4').value.trim();
  const proof = document.getElementById('previewArea');
  const profile = document.getElementById('profilePreviewArea');

  if(!payId || !last4 || !proof.dataset.img)
    return alert('Completa ID, últimos 4 del CBU y sube la captura.');

  if(!profile.dataset.pic)
    return alert('Debes subir tu foto de perfil.');

  const user = JSON.parse(localStorage.getItem('user') || 'null');
  if(!user) return alert('No hay usuario en sesión.');

  const verifications = JSON.parse(localStorage.getItem('verifications') || '[]');

  const entry = {
    id:'v-'+Date.now(),
    email:user.email,
    name:user.name,
    payId,
    last4,
    img: proof.dataset.img,
    profilePic: profile.dataset.pic,
    status:'pending',
    created:Date.now(),
    code:null
  };

  verifications.push(entry);
  localStorage.setItem('verifications', JSON.stringify(verifications));

  alert('Comprobante enviado. Esperá la verificación manual.');
  location.href='esperando.html';
}
</script>

</body>
</html>
