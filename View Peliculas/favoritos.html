<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Favoritos Mejorado</title>

  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: sans-serif;
    }

    /* Buscador */
    .search-box {
      width: 90%;
      margin: 15px auto;
      display: block;
      padding: 10px;
      border-radius: 10px;
      background: #1c1c1c;
      border: 1px solid #333;
      color: white;
    }

    /* Ordenador */
    .order-box {
      width: 90%;
      margin: 0 auto 15px;
      display: block;
      padding: 10px;
      border-radius: 10px;
      background: #111;
      color: white;
    }

    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      padding: 0 12px 30px;
      margin-top: 25px;
    }

    /* Tarjetas */
    .item {
      background: #000;
      border-radius: 10px;
      position: relative;
      opacity: 0;
      transform: scale(0.9);
      animation: fadeIn .3s forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .item img {
      width: 100%;
      height: 190px;
      object-fit: cover;
      border-radius: 8px;
    }

    .item-title {
      padding: 6px;
      font-size: .6rem;
      text-align: center;
    }

    .item-info {
      font-size: 0.55rem;
      text-align: center;
      color: #bbb;
      padding-bottom: 6px;
    }

    .delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: crimson;
      border: none;
      color: #fff;
      width: 22px;
      height: 22px;
      border-radius: 50%;
    }

    .selector {
      position: absolute;
      top: 5px;
      left: 5px;
      width: 20px;
      height: 20px;
      border-radius: 4px;
      background: #000a;
      border: 1px solid #fff;
      display: none;
    }

    .item.selected .selector {
      background: #00ff99;
      display: block;
    }

    /* Modal ordenar */
    .modal-order {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.7);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .order-box-modal {
      background: #111;
      padding: 20px;
      width: 90%;
      max-width: 350px;
      border-radius: 15px;
      text-align: center;
      animation: fadeUp .25s ease;
    }

    @keyframes fadeUp {
      from {
        transform: translateY(40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .order-option {
      width: 100%;
      background: #222;
      color: white;
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
    }

    .order-option:hover {
      background: #333;
    }

    .close-order {
      background: #444;
      color: white;
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      border: none;
      border-radius: 10px;
    }

    /* Modal eliminar */
    .delete-modal {
      position: fixed;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.75);
      z-index: 99999;
    }

    .delete-box {
      background: #151515;
      padding: 25px;
      border-radius: 14px;
      text-align: center;
      width: 75%;
      max-width: 350px;
      border: 2px solid #ff2d5b;
      box-shadow: 0 0 22px rgba(255,45,91,0.5);
      position: relative;
    }

    .close-delete {
      position: absolute;
      top: 6px;
      right: 8px;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      cursor: pointer;
    }

    .delete-img {
      width: 90%;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .delete-title {
      margin: 0;
      font-size: 1.1rem;
    }

    .delete-text {
      color: #ccc;
      margin: 12px 0 20px;
    }

    .btn-delete {
      background: linear-gradient(135deg, #ff2d55, #ff5e7e);
      border: none;
      padding: 10px 18px;
      color: #fff;
      border-radius: 999px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
    .category-badge {
  position: absolute;
  top: 34px;               /* ‚úÖ SIEMPRE abajo del selector */
  left: 6px;
  z-index: 10;
  background: rgba(0,0,0,0.75);
  padding: 3px 6px;
  font-size: .55rem;
  border-radius: 6px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: .5px;
  pointer-events: none;
}


.category-pelicula {
  background: #e50914;
}

.category-serie {
  background: #1db954;
}

/* ========================= */
/* üì± CELULARES PEQUE√ëOS */
/* ========================= */
@media (max-width: 360px) {
  .grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
  }

  .item img {
    height: 150px;
  }

  .item-title {
    font-size: 0.5rem;
  }

  .item-info {
    font-size: 0.45rem;
  }

  .search-box,
  .order-box {
    font-size: 0.75rem;
    padding: 8px;
  }
}

/* ========================= */
/* üì± CELULARES GRANDES */
/* ========================= */
@media (max-width: 480px) {
  .grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .item img {
    height: 170px;
  }

  .item-title {
    font-size: 0.6rem;
  }

  .item-info {
    font-size: 0.5rem;
  }
}

/* ========================= */
/* üì≤ TABLETS */
/* ========================= */
@media (min-width: 481px) and (max-width: 768px) {
  .grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .item img {
    height: 190px;
  }

  .item-title {
    font-size: 0.65rem;
  }

  .item-info {
    font-size: 0.55rem;
  }
}

/* ========================= */
/* üíª NOTEBOOKS Y PCs */
/* ========================= */
@media (min-width: 769px) and (max-width: 1200px) {
  .grid {
    grid-template-columns: repeat(5, 1fr);
  }
}

/* ========================= */
/* üì∫ PANTALLAS GRANDES */
/* ========================= */
@media (min-width: 1201px) {
  .grid {
    grid-template-columns: repeat(7, 1fr);
  }

  .item img {
    height: 240px;
  }

  .item-title {
    font-size: 0.75rem;
  }

  .item-info {
    font-size: 0.6rem;
  }
}

/* ========================= */
/* üíª MODAL ELIMINAR EN PC */
/* ========================= */
@media (min-width: 1024px) {
  .delete-box {
    max-width: 200px;
    width: 40%;
    padding: 30px;
    border-radius: 18px;
  }

  .delete-img {
      width: 80%;
      border-radius: 8px;
      margin-bottom: 12px;
    }

  .delete-title {
    font-size: 1.4rem;
  }

  .delete-text {
    font-size: 1rem;
  }

  .btn-delete {
    font-size: 1rem;
    padding: 14px;
  }

  .close-delete {
    font-size: 10px;
    padding: 6px 10px;
  }
}


body {
  padding-bottom: env(safe-area-inset-bottom);
}

/* ========================= */
/* ‚úÖ BAJAR ETIQUETA SI EST√Å SELECCIONADO */
/* ========================= */

.item.selected .category-badge {
  top: 30px !important;
}

/* Fijamos bien el selector arriba */
.selector {
  top: 6px !important;
  left: 6px !important;
  z-index: 30;
}

/* Bajamos un poco m√°s si quer√©s m√°s aire */
@media (max-width: 480px) {
  .item.selected .category-badge {
    top: 35px !important;
  }
}

/* Escritorio */
@media (min-width: 768px) {
  .item.selected .category-badge {
    top: 38px !important;
  }
}

  </style>
</head>

<body>
  

  <input id="buscar" class="search-box" placeholder="Buscar favoritos...">

  <button id="openOrderMenu" class="order-box">
    Ordenar: M√°s recientes
  </button>

  <p id="noResultsMsg" style="display:none;color:#aaa;text-align:center;margin-top:20px;">
  No se encuentra su Pel√≠cula o Serie en favoritos
</p>

  <!-- Modal ordenar -->
  <div id="orderModal" class="modal-order">
    <div class="order-box-modal">
      <h3>Ordenar por</h3>
      <button class="order-option" data-value="recientes">M√°s recientes</button>
      <button class="order-option" data-value="antiguos">M√°s antiguos</button>
      <button class="close-order">Cerrar</button>
    </div>
  </div>

  <button id="multiDeleteBtn" style="margin:10px;padding:10px;background:#ff007f;border:none;color:white;border-radius:8px;display:none;">
    Eliminar seleccionados
  </button>
  <button id="cancelSelectBtn" style="margin:10px;padding:10px;background:#333;border:none;color:white;border-radius:8px;display:none;">
  Cancelar selecci√≥n
</button>


  <div class="grid" id="favoritos-container"></div>

  <!-- Modal eliminar -->
  <div id="deleteModal" class="delete-modal">
    <div class="delete-box">
      <button class="close-delete" id="cancelDelete">‚úñ</button>
      <img id="deleteImg" class="delete-img">
      <h3 id="deleteTitle" class="delete-title"></h3>
      <p class="delete-text">¬øDeseas eliminar este favorito?</p>
      <button id="confirmDelete" class="btn-delete">Eliminar</button>
    </div>
  </div>

<script>
  function normalizar(str) {
    if (!str) return "";
    return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
  }

  let favoritos = JSON.parse(localStorage.getItem('favoritos_detalles') || '[]');
  let multiMode = false;
  let seleccionados = [];
  let indexAEliminar = null;

  function asegurarTimestamp() {
  let base = Date.now() - favoritos.length * 1000;

  favoritos.forEach((item, i) => {
    if (!item.timestamp) {
      item.timestamp = base + i * 1000; // escalonado real
    }
  });

  localStorage.setItem("favoritos_detalles", JSON.stringify(favoritos));
}

  function renderFavoritos() {
    if (openOrderMenu.innerText.includes("recientes")) {
  favoritos.sort((a, b) => b.timestamp - a.timestamp);
} else {
  favoritos.sort((a, b) => a.timestamp - b.timestamp);
}
    const container = document.getElementById("favoritos-container");
    container.innerHTML = "";

    favoritos.forEach((item, index) => {
      let extraInfo = "";

      // TIEMPO REAL
const ahora = Date.now();
const edad = ahora - item.timestamp;

// Reci√©n agregado = menos de 24 horas
if (edad < 24 * 60 * 60 * 1000) {
  extraInfo = "Reciente";
}

// M√°s antiguo = m√°s de 15 d√≠as
if (edad > 15 * 24 * 60 * 60 * 1000) {
  extraInfo = "Antiguo";
}


      const div = document.createElement("div");
      div.className = "item";
      const tipo = item.tipo ? item.tipo.toLowerCase() : "pelicula";

div.innerHTML = `
  <div class="selector"></div>

  <img src="${item.imagen}">
  
  <div class="category-badge category-${tipo}">
    ${tipo.toUpperCase()}
  </div>

  <div class="item-title">${item.titulo}</div>
  <div class="item-info">${extraInfo}</div>
  <button class="delete-btn" onclick="event.stopPropagation(); eliminarFavorito(${index})">√ó</button>

`;


      div.onclick = (e) => {
        if (multiMode) {
          div.classList.toggle("selected");
          if (div.classList.contains("selected")) seleccionados.push(index);
          else seleccionados = seleccionados.filter(i => i !== index);
        } else {
          openPreview(item);
        }
      };

      div.oncontextmenu = (e) => {
        e.preventDefault();
        activarSeleccionMultiple();
      };

      container.appendChild(div);
    });
  }

  buscar.oninput = e => {
  const term = normalizar(e.target.value);
  let visibles = 0;

  document.querySelectorAll(".item").forEach(card => {
    const title = normalizar(card.querySelector(".item-title").innerText);

    if (title.includes(term)) {
      card.style.display = "";
      visibles++;
    } else {
      card.style.display = "none";
    }
  });

  document.getElementById("noResultsMsg").style.display =
    visibles === 0 ? "block" : "none";
};


  openOrderMenu.onclick = () => orderModal.style.display = "flex";
  document.querySelector(".close-order").onclick = () => orderModal.style.display = "none";

  document.querySelectorAll(".order-option").forEach(btn => {
    btn.onclick = () => {
      const value = btn.dataset.value;

      if (value === "recientes") {
        favoritos.sort((a, b) => b.timestamp - a.timestamp);
        openOrderMenu.innerText = "Ordenar: M√°s recientes";
      } else {
        favoritos.sort((a, b) => a.timestamp - b.timestamp);
        openOrderMenu.innerText = "Ordenar: M√°s antiguos";
      }

      renderFavoritos();
      orderModal.style.display = "none";
    };
  });

  function eliminarFavorito(i) {
    indexAEliminar = i;
    deleteImg.src = favoritos[i].imagen;
    deleteTitle.innerText = favoritos[i].titulo;
    deleteModal.style.display = "flex";
  }

  cancelDelete.onclick = () => {
    indexAEliminar = null;
    deleteModal.style.display = "none";
  };

  confirmDelete.onclick = () => {
    if (indexAEliminar !== null) {
      favoritos.splice(indexAEliminar, 1);
      localStorage.setItem("favoritos_detalles", JSON.stringify(favoritos));
      renderFavoritos();
    }
    deleteModal.style.display = "none";
  };

  function activarSeleccionMultiple() {
  multiMode = true;

  document.querySelectorAll(".item").forEach(item => {
    item.classList.remove("selected");
  });

  document.querySelectorAll(".selector").forEach(s => s.style.display = "block");

  document.getElementById("multiDeleteBtn").style.display = "inline-block";
  document.getElementById("cancelSelectBtn").style.display = "inline-block";

  seleccionados = [];
}

  function openPreview(item) {
  if (item.archivo) {
    window.location.href = item.archivo;
  } else {
    alert("Archivo no encontrado");
  }
}
  function closePreview() {}

  asegurarTimestamp();
favoritos.sort((a, b) => b.timestamp - a.timestamp); // ‚úÖ ordenar al cargar
renderFavoritos();

</script>

<script>
  document.getElementById("cancelSelectBtn").onclick = () => {
  multiMode = false;
  seleccionados = [];

  // Quitar selecci√≥n visual
  document.querySelectorAll(".item").forEach(item => {
    item.classList.remove("selected");
  });

  // Ocultar botones
  document.getElementById("multiDeleteBtn").style.display = "none";
  document.getElementById("cancelSelectBtn").style.display = "none";

  // Ocultar selectores
  document.querySelectorAll(".selector").forEach(s => s.style.display = "none");
};

multiDeleteBtn.onclick = () => {
  favoritos = favoritos.filter((_, i) => !seleccionados.includes(i));

  // Guardar cambios
  localStorage.setItem("favoritos_detalles", JSON.stringify(favoritos));

  // Resetear modo selecci√≥n
  seleccionados = [];
  multiMode = false;

  // Ocultar controles
  document.getElementById("multiDeleteBtn").style.display = "none";
  document.getElementById("cancelSelectBtn").style.display = "none";

  document.querySelectorAll(".selector").forEach(s => s.style.display = "none");

  renderFavoritos();
};


</script>

</body>
</html>
