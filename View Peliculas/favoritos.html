<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Favoritos Mejorado</title>

  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: sans-serif;
    }

    /* Buscador */
    .search-box {
      width: 90%;
      margin: 15px auto;
      display: block;
      padding: 10px;
      border-radius: 10px;
      background: #1c1c1c;
      border: 1px solid #333;
      color: white;
    }

    /* Ordenador */
    .order-box {
      width: 90%;
      margin: 0 auto 15px;
      display: block;
      padding: 10px;
      border-radius: 10px;
      background: #111;
      color: white;
    }

    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      padding: 0 12px 30px;
      margin-top: 25px;
    }

    /* Tarjetas */
    .item {
      background: #000;
      border-radius: 10px;
      position: relative;
      opacity: 0;
      transform: scale(0.9);
      animation: fadeIn .3s forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .item img {
      width: 100%;
      height: 190px;
      object-fit: cover;
      border-radius: 8px;
    }

    .item-title {
      padding: 6px;
      font-size: .6rem;
      text-align: center;
    }

    .item-info {
      font-size: 0.55rem;
      text-align: center;
      color: #bbb;
      padding-bottom: 6px;
    }

    .delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: crimson;
      border: none;
      color: #fff;
      width: 22px;
      height: 22px;
      border-radius: 50%;
    }

    .selector {
      position: absolute;
      top: 5px;
      left: 5px;
      width: 20px;
      height: 20px;
      border-radius: 4px;
      background: #000a;
      border: 1px solid #fff;
      display: none;
    }

    .item.selected .selector {
      background: #00ff99;
      display: block;
    }

    /* Modal ordenar */
    .modal-order {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.7);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .order-box-modal {
      background: #111;
      padding: 20px;
      width: 90%;
      max-width: 350px;
      border-radius: 15px;
      text-align: center;
      animation: fadeUp .25s ease;
    }

    @keyframes fadeUp {
      from {
        transform: translateY(40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .order-option {
      width: 100%;
      background: #222;
      color: white;
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
    }

    .order-option:hover {
      background: #333;
    }

    .close-order {
      background: #444;
      color: white;
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      border: none;
      border-radius: 10px;
    }

    /* Modal eliminar */
    .delete-modal {
      position: fixed;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.75);
      z-index: 99999;
    }

    .delete-box {
      background: #151515;
      padding: 25px;
      border-radius: 14px;
      text-align: center;
      width: 75%;
      max-width: 350px;
      border: 2px solid #ff2d5b;
      box-shadow: 0 0 22px rgba(255,45,91,0.5);
      position: relative;
    }

    .close-delete {
      position: absolute;
      top: 6px;
      right: 8px;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      cursor: pointer;
    }

    .delete-img {
      width: 90%;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .delete-title {
      margin: 0;
      font-size: 1.1rem;
    }

    .delete-text {
      color: #ccc;
      margin: 12px 0 20px;
    }

    .btn-delete {
      background: linear-gradient(135deg, #ff2d55, #ff5e7e);
      border: none;
      padding: 10px 18px;
      color: #fff;
      border-radius: 999px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
  </style>
</head>

<body>

  <input id="buscar" class="search-box" placeholder="Buscar favoritos...">

  <button id="openOrderMenu" class="order-box">
    Ordenar: Más recientes
  </button>

  <!-- Modal ordenar -->
  <div id="orderModal" class="modal-order">
    <div class="order-box-modal">
      <h3>Ordenar por</h3>
      <button class="order-option" data-value="recientes">Más recientes</button>
      <button class="order-option" data-value="antiguos">Más antiguos</button>
      <button class="close-order">Cerrar</button>
    </div>
  </div>

  <button id="multiDeleteBtn" style="margin:10px;padding:10px;background:#ff007f;border:none;color:white;border-radius:8px;display:none;">
    Eliminar seleccionados
  </button>
  <button id="cancelSelectBtn" style="margin:10px;padding:10px;background:#333;border:none;color:white;border-radius:8px;display:none;">
  Cancelar selección
</button>


  <div class="grid" id="favoritos-container"></div>

  <!-- Modal eliminar -->
  <div id="deleteModal" class="delete-modal">
    <div class="delete-box">
      <button class="close-delete" id="cancelDelete">✖</button>
      <img id="deleteImg" class="delete-img">
      <h3 id="deleteTitle" class="delete-title"></h3>
      <p class="delete-text">¿Deseas eliminar este favorito?</p>
      <button id="confirmDelete" class="btn-delete">Eliminar</button>
    </div>
  </div>

<script>
  function normalizar(str) {
    if (!str) return "";
    return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
  }

  let favoritos = JSON.parse(localStorage.getItem('favoritos_detalles') || '[]');
  let multiMode = false;
  let seleccionados = [];
  let indexAEliminar = null;

  function renderFavoritos() {
    const container = document.getElementById("favoritos-container");
    container.innerHTML = "";

    favoritos.forEach((item, index) => {
      let extraInfo = "";

      if (openOrderMenu.innerText.includes("recientes")) {
        if (index === 0) extraInfo = "Más reciente";
        if (index === favoritos.length - 1) extraInfo = "Más antiguo";
      } else {
        if (index === 0) extraInfo = "Más antiguo";
        if (index === favoritos.length - 1) extraInfo = "Más reciente";
      }

      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="selector"></div>
        <img src="${item.imagen}">
        <div class="item-title">${item.titulo}</div>
        <div class="item-info">${extraInfo}</div>
        <button class="delete-btn" onclick="eliminarFavorito(${index})">×</button>
      `;

      div.onclick = (e) => {
        if (multiMode) {
          div.classList.toggle("selected");
          if (div.classList.contains("selected")) seleccionados.push(index);
          else seleccionados = seleccionados.filter(i => i !== index);
        } else {
          openPreview(item);
        }
      };

      div.oncontextmenu = (e) => {
        e.preventDefault();
        activarSeleccionMultiple();
      };

      container.appendChild(div);
    });
  }

  buscar.oninput = e => {
    const term = normalizar(e.target.value);
    document.querySelectorAll(".item").forEach(card => {
      const title = normalizar(card.querySelector(".item-title").innerText);
      card.style.display = title.includes(term) ? "" : "none";
    });
  };

  openOrderMenu.onclick = () => orderModal.style.display = "flex";
  document.querySelector(".close-order").onclick = () => orderModal.style.display = "none";

  document.querySelectorAll(".order-option").forEach(btn => {
    btn.onclick = () => {
      const value = btn.dataset.value;

      if (value === "recientes") {
        favoritos.sort((a, b) => b.timestamp - a.timestamp);
        openOrderMenu.innerText = "Ordenar: Más recientes";
      } else {
        favoritos.sort((a, b) => a.timestamp - b.timestamp);
        openOrderMenu.innerText = "Ordenar: Más antiguos";
      }

      renderFavoritos();
      orderModal.style.display = "none";
    };
  });

  function eliminarFavorito(i) {
    indexAEliminar = i;
    deleteImg.src = favoritos[i].imagen;
    deleteTitle.innerText = favoritos[i].titulo;
    deleteModal.style.display = "flex";
  }

  cancelDelete.onclick = () => {
    indexAEliminar = null;
    deleteModal.style.display = "none";
  };

  confirmDelete.onclick = () => {
    if (indexAEliminar !== null) {
      favoritos.splice(indexAEliminar, 1);
      localStorage.setItem("favoritos_detalles", JSON.stringify(favoritos));
      renderFavoritos();
    }
    deleteModal.style.display = "none";
  };

  function activarSeleccionMultiple() {
  multiMode = true;

  document.querySelectorAll(".item").forEach(item => {
    item.classList.remove("selected");
  });

  document.querySelectorAll(".selector").forEach(s => s.style.display = "block");

  document.getElementById("multiDeleteBtn").style.display = "inline-block";
  document.getElementById("cancelSelectBtn").style.display = "inline-block";

  seleccionados = [];
}

  function openPreview(item) { alert("Preview pendiente"); }
  function closePreview() {}

  renderFavoritos();
</script>

<script>
  document.getElementById("cancelSelectBtn").onclick = () => {
  multiMode = false;
  seleccionados = [];

  // Quitar selección visual
  document.querySelectorAll(".item").forEach(item => {
    item.classList.remove("selected");
  });

  // Ocultar botones
  document.getElementById("multiDeleteBtn").style.display = "none";
  document.getElementById("cancelSelectBtn").style.display = "none";

  // Ocultar selectores
  document.querySelectorAll(".selector").forEach(s => s.style.display = "none");
};

multiDeleteBtn.onclick = () => {
  favoritos = favoritos.filter((_, i) => !seleccionados.includes(i));

  // Guardar cambios
  localStorage.setItem("favoritos_detalles", JSON.stringify(favoritos));

  // Resetear modo selección
  seleccionados = [];
  multiMode = false;

  // Ocultar controles
  document.getElementById("multiDeleteBtn").style.display = "none";
  document.getElementById("cancelSelectBtn").style.display = "none";

  document.querySelectorAll(".selector").forEach(s => s.style.display = "none");

  renderFavoritos();
};


</script>

</body>
</html>
